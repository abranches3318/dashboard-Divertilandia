<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - DivertilÃ¢ndia</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/dashboard.css" />
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.css" rel="stylesheet">

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="img/favicon.ico">

  <style>
    /* pequenas garantias de layout para evitar que o calendÃ¡rio quebre */
    #calendar { max-width: 100%; margin: 0 auto; height: 560px; }
    .pagina { display: none; }
    .pagina.ativa { display: block; }
    /* garantir que elementos que nÃ£o existirem nÃ£o quebrem scripts */
  </style>
</head>

<body>

  <!-- BotÃ£o Hamburger -->
  <button class="btn-hamburger" onclick="document.querySelector('.sidebar')?.classList.toggle('active')">
    â˜°
  </button>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="img/logo.png" class="logo-img" alt="DivertilÃ¢ndia" />
    </div>

    <nav>
      <ul>
        <li class="active" onclick="nav('dashboard')">ğŸ“Š Dashboard</li>
        <li onclick="nav('agendamentos')">ğŸ“… Agendamentos</li>
        <li onclick="nav('financeiro')">ğŸ’° Financeiro</li>
        <li onclick="nav('itens')">ğŸˆ Itens / CatÃ¡logo</li>
        <li onclick="nav('pacotes')">ğŸ Pacotes</li>
        <li onclick="nav('monitores')">ğŸ§‘â€ğŸ« Monitores</li>
        <li onclick="nav('tarefas')">ğŸ“ Tarefas</li>
        <li onclick="nav('conversas')">ğŸ’¬ Conversas (tempo real)</li>
        <li onclick="logout()">ğŸšª Sair</li>
      </ul>
    </nav>
  </aside>

  <!-- ConteÃºdo -->
  <main class="content">
    <!-- Navbar -->
    <header class="topbar">
      <h1 id="titulo-pagina">Dashboard</h1>
      <div class="top-right">
        <div class="notif" onclick="abrirNotificacoes()">
          ğŸ”” <span id="notif-count">0</span>
        </div>
        <div class="user-info">
          <span id="user-name">UsuÃ¡rio</span>
        </div>
      </div>
    </header>

    <!-- SEÃ‡ÃƒO DASHBOARD -->
    <section id="pagina-dashboard" class="pagina ativa">
      <div class="cards">
        <div class="card" onclick="abrirListaAgendamentosHoje()">
          <h3>Agendamentos Hoje</h3>
          <p id="ag-hoje">0</p>
        </div>
        <div class="card">
          <h3>Receita Mensal</h3>
          <p id="receita-mes">R$ 0,00</p>
        </div>
        <div class="card">
          <h3>Tarefas Pendentes</h3>
          <p id="tarefas-pendentes">0</p>
        </div>
      </div>

      <div class="panel">
        <h2>ğŸ“… CalendÃ¡rio</h2>
        <div id="calendar"></div>
      </div>
    </section>

    <!-- PAGINA AGENDAMENTOS (opcional: vocÃª pode tambÃ©m usar agendamentos.html separado) -->
    <section id="pagina-agendamentos" class="pagina">
      <div class="topo-secao" style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Agendamentos</h2>
        <div>
          <button id="btnNovoAgendamento" class="btn">+ Novo Agendamento</button>
        </div>
      </div>

      <div class="filtros-agendamentos" style="margin-top:15px; display:flex; flex-wrap:wrap; gap:12px;">
        <div class="campo-filtro">
          <label for="filtroData">Data</label>
          <input type="date" id="filtroData">
        </div>
        <div class="campo-filtro">
          <label for="filtroCliente">Cliente</label>
          <input type="text" id="filtroCliente" placeholder="Nome do cliente">
        </div>
        <div class="campo-filtro">
          <label for="filtroTelefone">Telefone</label>
          <input type="text" id="filtroTelefone" placeholder="(DDD) 9XXXX-XXXX">
        </div>
        <div class="campo-filtro">
          <label for="filtroStatus">Status</label>
          <select id="filtroStatus">
            <option value="">Todos</option>
            <option value="pendente">Pendente</option>
            <option value="confirmado">Confirmado</option>
            <option value="concluido">ConcluÃ­do</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>
        <div style="align-self:end;">
          <button id="btnFiltrarAgendamentos" class="btn">Filtrar</button>
        </div>
      </div>

      <div style="margin-top:16px; overflow-x:auto;">
        <table class="tabela-agendamentos" style="width:100%;">
          <thead>
            <tr>
              <th>Data</th>
              <th>Cliente</th>
              <th>Telefone</th>
              <th>Status</th>
              <th>Valor</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody id="listaAgendamentos"></tbody>
        </table>
      </div>
    </section>

  </main>

  <!-- Firebase compat (must be before scripts that use firebase) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

  <!-- Your firebase-config (keeps const db) -->
  <script src="firebase-config.js"></script>

  <!-- FullCalendar (global) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Calendar module (defines window.renderCalendar) -->
  <script src="js/calendar.js"></script>

  <!-- Dashboard core (auth state, counts, carregarAgendamentos -> calls window.renderCalendar) -->
  <script src="js/dashboard.js"></script>

  <!-- Agendamentos UI/logic (works with embedded section or separate page) -->
  <script src="js/agendamentos.js"></script>

  <!-- Outros mÃ³dulos (carregue por Ãºltimo) -->
  <script src="js/monitor.js"></script>
  <script src="js/checklist.js"></script>
  <script src="js/ordemServico.js"></script>
  <script src="js/tarefas.js"></script>
  <script src="js/notificacoes.js"></script>

  <script>
    // Logout â€” usa window.auth (setado por dashboard.js)
    function logout() {
      if (window.auth && typeof window.auth.signOut === 'function') {
        window.auth.signOut().then(() => window.location.href = "index.html");
      } else {
        // fallback: usar firebase.auth diretamente
        if (firebase && firebase.auth) {
          firebase.auth().signOut().then(() => window.location.href = "index.html");
        } else {
          window.location.href = "index.html";
        }
      }
    }

    // NavegaÃ§Ã£o entre seÃ§Ãµes (simples)
    function nav(pagina) {
      document.querySelectorAll(".pagina").forEach(sec => sec.classList.remove("ativa"));
      const el = document.getElementById("pagina-" + pagina);
      if (el) el.classList.add("ativa");

      document.querySelectorAll(".sidebar ul li").forEach(li => li.classList.remove("active"));
      const liAtivo = Array.from(document.querySelectorAll(".sidebar ul li"))
        .find(li => li.getAttribute("onclick")?.includes(`'${pagina}'`) || li.getAttribute("onclick")?.includes(`${pagina}`));
      if (liAtivo) liAtivo.classList.add("active");
    }

    // abrir agendamentos de hoje pelo card
    function abrirListaAgendamentosHoje() {
      const hoje = new Date().toISOString().slice(0,10);
      const f = document.getElementById('filtroData'); if (f) f.value = hoje;
      nav('agendamentos');
      // dispara filtro (se o mÃ³dulo jÃ¡ estiver carregado)
      if (typeof aplicarFiltros === 'function') aplicarFiltros();
    }

    // abrir notificaÃ§Ãµes
    function abrirNotificacoes(){ nav('notificacoes'); }
  </script>

</body>
</html>
