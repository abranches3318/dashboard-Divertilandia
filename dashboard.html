<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - DivertilÃ¢ndia</title>

  <!-- CSS principal (use seu css existente) -->
  <link rel="stylesheet" href="css/dashboard.css" />

  <!-- FullCalendar CSS (visual) -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.css" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" href="img/favicon.ico">

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    /* Pequenas salvaguardas para evitar que o calendÃ¡rio quebre layout */
    #calendar { max-width:100%; margin:0 auto; height:600px; }
    .pagina { display:none; }
    .pagina.ativa { display:block; }
    /* Garantir que caracteres do FullCalendar apareÃ§am em PT */
    .fc-toolbar-title { font-weight:700; }
  </style>
</head>

<body>

  <!-- BotÃ£o Hamburger (mobile) -->
  <button class="btn-hamburger" onclick="document.querySelector('.sidebar')?.classList.toggle('active')">
    â˜°
  </button>

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <img src="img/logo.png" class="logo-img" alt="DivertilÃ¢ndia" />
    </div>

    <nav>
      <ul>
        <!-- NavegaÃ§Ã£o multi-pÃ¡ginas: abre outras pÃ¡ginas HTML separadas -->
        <li class="active" onclick="nav('dashboard')">ğŸ“Š Dashboard</li>
        <li onclick="nav('agendamentos')">ğŸ“… Agendamentos</li>
        <li onclick="nav('financeiro')">ğŸ’° Financeiro</li>
        <li onclick="nav('itens')">ğŸˆ CatÃ¡logo</li>
        <li onclick="nav('pacotes')">ğŸ Pacotes</li>
        <li onclick="nav('monitores')">ğŸ§‘â€ğŸ« Monitores</li>
        <li onclick="nav('tarefas')">ğŸ“ Tarefas</li>
        <li onclick="nav('conversas')">ğŸ’¬ Conversas (tempo real)</li>
        <li onclick="logout()">ğŸšª Sair</li>
      </ul>
    </nav>
  </aside>

  <!-- CONTEÃšDO PRINCIPAL -->
  <main class="content">

    <!-- TOPBAR -->
    <header class="topbar">
      <h1 id="titulo-pagina">Dashboard</h1>
      <div class="top-right">
        <div class="notif" onclick="nav('notificacoes')">
          ğŸ”” <span id="notif-count">0</span>
        </div>
        <div class="user-info">
          <span id="user-name">UsuÃ¡rio</span>
        </div>
      </div>
    </header>

    <!-- PÃGINA: DASHBOARD -->
    <section id="pagina-dashboard" class="pagina ativa">
      <div class="cards">
        <div class="card" id="card-agendamentos-hoje" style="cursor:pointer;">
          <h3>Agendamentos Hoje</h3>
          <p id="ag-hoje">0</p>
        </div>
        <div class="card" id="card-receita-mes" style="cursor:pointer;">
          <h3>Receita Mensal</h3>
          <p id="receita-mes">R$ 0,00</p>
        </div>
        <div class="card" id="card-tarefas-pendentes" style="cursor:pointer;">
          <h3>Tarefas Pendentes</h3>
          <p id="tarefas-pendentes">0</p>
        </div>
      </div>

      <div class="panel">
        <h2>ğŸ“… CalendÃ¡rio</h2>
        <div id="calendar"></div>
      </div>
    </section>

    <!-- PÃGINA: AGENDAMENTOS (conteÃºdo mÃ­nimo, cliente usarÃ¡ pÃ¡gina separada) -->
    <section id="pagina-agendamentos" class="pagina">
      <div class="topo-secao" style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Agendamentos</h2>
        <div>
          <button id="btnNovoAgendamento" class="btn">+ Novo Agendamento</button>
        </div>
      </div>

      <div class="filtros-agendamentos" style="margin-top:15px; display:flex; flex-wrap:wrap; gap:12px;">
        <div class="campo-filtro"><label for="filtroData">Data</label><input type="date" id="filtroData"></div>
        <div class="campo-filtro"><label for="filtroCliente">Cliente</label><input type="text" id="filtroCliente" placeholder="Nome do cliente"></div>
        <div class="campo-filtro"><label for="filtroTelefone">Telefone</label><input type="text" id="filtroTelefone" placeholder="(DDD) 9XXXX-XXXX"></div>
        <div class="campo-filtro"><label for="filtroStatus">Status</label>
          <select id="filtroStatus">
            <option value="">Todos</option>
            <option value="pendente">Pendente</option>
            <option value="confirmado">Confirmado</option>
            <option value="concluido">ConcluÃ­do</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>
        <div style="align-self:end;"><button id="btnFiltrarAgendamentos" class="btn">Filtrar</button></div>
      </div>

      <div style="margin-top:16px; overflow-x:auto;">
        <table class="tabela-agendamentos" style="width:100%;">
          <thead>
            <tr>
              <th>Data</th><th>Cliente</th><th>Telefone</th><th>Status</th><th>Valor</th><th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody id="listaAgendamentos"></tbody>
        </table>
      </div>
    </section>

  </main>

  <!-- =========================
       SCRIPTS (ordem importante)
       1) Firebase compat
       2) firebase-config.js (Ãºnico lugar que inicializa app / define db)
       3) SweetAlert2
       4) dashboard.js (logic minimal / UI hooks)
       5) FullCalendar (visual + runtime)
       6) calendar.js (calendar behavior)
       7) agendamentos.js (list/filter/create)
       8) demais mÃ³dulos
  ========================= -->

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

  <!-- Sua configuraÃ§Ã£o do Firebase (deve inicializar o app e definir window.db / window.auth se desejar) -->
  <script src="firebase-config.js"></script>

  <!-- SweetAlert2 (usado em vÃ¡rios mÃ³dulos) -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- dashboard.js: hooks UI + chamadas para preencher cards. Deve existir em js/dashboard.js -->
  <script src="js/dashboard.js"></script>

  <!-- FullCalendar runtime (global bundle) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>

  <!-- calendar.js (implementa integraÃ§Ã£o FullCalendar => agendamentos). Deve existir em js/calendar.js -->
  <script src="js/calendar.js"></script>

  <!-- agendamentos.js (lista, filtros, criar). Deve existir em js/agendamentos.js -->
  <script src="js/agendamentos.js"></script>

  <!-- outros mÃ³dulos opcionais -->
  <script src="js/monitor.js"></script>
  <script src="js/checklist.js"></script>
  <script src="js/ordemServico.js"></script>
  <script src="js/tarefas.js"></script>
  <script src="js/notificacoes.js"></script>

  <script>
    // NavegaÃ§Ã£o multi-pÃ¡ginas: abre arquivos HTML separados (multipages).
    // Ajuste os nomes de arquivo se seus arquivos estiverem em outra pasta.
    function nav(dest) {
      const map = {
        dashboard: 'dashboard.html',
        agendamentos: 'pages/agendamentos.html',
        financeiro: 'pages/financeiro.html',
        itens: 'pages/itens.html',
        pacotes: 'pages/pacotes.html',
        monitores: 'pages/monitores.html',
        tarefas: 'pages/tarefas.html',
        conversas: 'pages/conversas.html',
        notificacoes: 'pages/notificacoes.html'
      };
      const file = map[dest];
      // se for dashboard, ficar na mesma pÃ¡gina; caso contrÃ¡rio navegar
      if (!file || dest === 'dashboard') {
        // apenas alterna visualmente se houver mÃºltiplas seÃ§Ãµes na mesma pÃ¡gina
        document.querySelectorAll('.pagina').forEach(p=>p.classList.remove('ativa'));
        const el = document.getElementById('pagina-' + (dest || 'dashboard'));
        if (el) el.classList.add('ativa');
        // atualizar tÃ­tulos
        const titulo = document.getElementById('titulo-pagina');
        if (titulo && el) {
          const h2 = el.querySelector('h2');
          titulo.textContent = h2 ? h2.textContent : 'Dashboard';
        }
        return;
      }
      // navega para a pÃ¡gina separada (multipages)
      window.location.href = file;
    }

    // Logout seguro: usa firebase.auth() diretamente para evitar problemas de scoping.
    function logout() {
      if (window.firebase && firebase.auth) {
        firebase.auth().signOut().then(()=> {
          window.location.href = 'index.html';
        }).catch(err => {
          console.error('Erro ao deslogar:', err);
          Swal.fire('Erro', 'NÃ£o foi possÃ­vel deslogar.', 'error');
        });
      } else {
        // fallback
        window.location.href = 'index.html';
      }
    }

    // Atualiza user-name e oferece cliques nos cards
    (function attachUiHandlers() {
      // Atualiza user display quando auth estiver pronto
      if (window.firebase && firebase.auth) {
        firebase.auth().onAuthStateChanged(user => {
          const el = document.getElementById('user-name');
          if (el) el.textContent = user ? (user.displayName || user.email) : 'UsuÃ¡rio';
        });
      }

      // Cards clicÃ¡veis
      document.getElementById('card-agendamentos-hoje')?.addEventListener('click', ()=> nav('agendamentos'));
      document.getElementById('card-tarefas-pendentes')?.addEventListener('click', ()=> nav('tarefas'));
      document.getElementById('card-receita-mes')?.addEventListener('click', ()=> nav('financeiro'));
    })();
  </script>

</body>
</html>
